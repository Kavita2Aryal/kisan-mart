$('.get-hyperlink-page').select2({
    ajax: {
        url: $('.has-hyperlink-search').data('hyperlink-search'),
        dataType: 'json',
        delay: 250,
        data: function (params) {
            return {
                q: params.term,
                page: params.page
            };
        },
        processResults: function (data, params) {
            params.page = params.page || 1;
            return {
                results: data.payload,
                pagination: {
                    more: (params.page * 30) < data.total_count
                }
            };
        },
        cache: false
    },
    placeholder: 'Search a page',
    minimumInputLength: 1,
    templateResult: page_format,
    templateSelection: page_selection
});
var page_selection = function (data) {
    return data.title || data.name || data.text;
}
var page_format = function (data) {
    if (data.loading) {
        return data.text;
    }
    return $(
        "<div class='select2-result-page clearfix'>" +
        "<div class='select2-result-page__meta'>" +
        "<div class='select2-result-page__data'>" +
        "<span>" + data.text + "</span>" +
        "<span class='pull-right'>" + data.url + "</span>" +
        "<input type='hidden' class='select2-result-page__title' value='" + data.text + "'>" +
        "<input type='hidden' class='select2-result-page__id' value='" + data.id + "'>" +
        "</div>" +
        "</div>" +
        "</div>"
    );
}