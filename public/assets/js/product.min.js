$(document).on('click', '.btn-submit', function(e) {
    e.preventDefault();
    $name = $('.product-name')
    $.ajax({
        url: url_product_check,
        type: 'PUT',
        data: { name: $name.val() },
        async: false,
        success: function(response) {
            if (response.data == false) {
                $('.form-product').submit();
                return true;
            } else if (response.data == 'name') {
                $name.parents('.form-group').find('.invalid-feedback').remove();
                $name.parents('.form-group').append('<span class="invalid-feedback" role="alert">The name has already been taken.<strong></strong></span>');
            }
        }
    })
});

$(document).on('change', '.has-variant', function() {
    if ($(this).is(':checked')) {
        $('.is-variant-container').each(function() {
            $(this).removeClass('display-none');
        });
        $('.add-variant').removeClass('display-none');
        $('.not-variant-container').each(function() {
            $(this).addClass('display-none');
        });
        $('.not-variant-selling-price').removeAttr('required');
        $('.not-variant-qty').removeAttr('required');
    } else {
        $('.is-variant-container').each(function() {
            $(this).addClass('display-none');
        });
        $('.add-variant').addClass('display-none');
        $('.not-variant-container').each(function() {
            $(this).removeClass('display-none');
        });
        $('.not-variant-selling-price').prop('required', true);
        $('.not-variant-qty').removeAttr('required', true);
        $('.is-variant-item').html('');
    }
});

var color_arrays = [];
var size_arrays = [];
var prev_color_arrays = [];
var prev_size_arrays = [];
var previous_selected_variant = [];

var display_product_variant = function(product_selected_colors, product_selected_sizes) {
    if (product_selected_sizes.length > 0) {
        add_selected_size(product_selected_sizes);
    }
    if (product_selected_colors.length > 0) {
        add_selected_color(product_selected_colors);
    }
}

$(document).on('change', '.size-option-value', function() {
    var selected_sizes_option = $(this).val();
    var selected_sizes = [];
    if (selected_sizes_option.length !== 0) {
        $.map(selected_sizes_option, function(item, i) {
            $.map(sizes_all, function(s, j) {
                if (s.id == item) {
                    selected_sizes.push(s);
                }
            });
        });
        add_selected_size(selected_sizes);
    } else {
        selected_sizes = ['default'];
        add_selected_size(selected_sizes);
    }
});

var add_selected_size = function(selected_sizes) {
    size_arrays = [];
    size_arrays.push(selected_sizes);
    var size_name_arrays = [];

    if (size_arrays.length > 0 && size_arrays[0][0] === 'default') {
        if (color_arrays.length == 0) {
            previous_selected_variant = [];
        } else if (color_arrays.length > 0 && color_arrays[0][0] == 'default') {
            previous_selected_variant = [];
        }
    }
    var removedItem = '';
    if (selected_sizes.includes("default") == false) {
        $.each(selected_sizes, function(i, selected_size) {
            size_name_arrays.push(selected_size.slug);
        });
    }
    if (size_name_arrays.length <= prev_size_arrays.length) {
        removedItem = get_removed_item(prev_size_arrays, size_name_arrays);
    }
    prev_size_arrays = size_name_arrays;
    crossJoin(color_arrays, size_arrays, removedItem);
}

$(document).on('change', '.color-option-value', function() {
    var selected_colors_option = $(this).val();
    var selected_colors = [];
    if (selected_colors_option.length !== 0) {
        $.map(selected_colors_option, function(item, i) {
            $.map(colors_all, function(c, j) {
                if (c.id == item) {
                    selected_colors.push(c);
                }
            });
        });
        add_selected_color(selected_colors);
    } else {
        selected_colors = ['default'];
        add_selected_color(selected_colors);
    }
});

var add_selected_color = function(selected_colors) {
    var content = '';
    var index = 0;
    var product_colors = product_color_image_arr;
    var product_colors_id = product_color_id_arr;
    var color_name_arrays = [];
    $('.color-item-container').html('');
    if (selected_colors.includes("default") == false) {

        $.each(selected_colors, function(i, selected_color) {
            var color_class = 'color-' + selected_color.slug;
            index = $('.color-item-container').find('.selected-color-content').length + 1;
            console.log($('.' + color_class).length, product_colors);
            if (type == "edit") {
                if ($('.' + color_class).length <= 0) {
                //     if (product_colors != null) {
                //         var color_name_arr = product_colors.map(function(value) { // product_colors['variant'] stored in db
                //             return value['color'];
                //         });
                //     }
                    var images = '';
                    var image_content = '';

                    if ($.inArray(selected_color.id, product_colors_id) !== -1) {
                        var images = product_colors != null ? (typeof(product_colors[selected_color.id]) !== "undefined" ? product_colors[selected_color.id].images : null) : null;
                        $.each(images, function(ii, val) {
                            image_content += '<input type="hidden" name="colors[' + index + '][images][' + ii + ']" data-image="' + val + '" value="' + val + '"/>';
                        });
                    }
                    content = '<div class="col-sm-12 col-md-6 col-lg-4 selected-color-content ' + color_class + '" data-index="' + color_class + '">' +
                        '<div class="card">' +
                        '<div class="card-header">' +
                        '<div class="card-title full-width">' +
                        '<span class="show-color-selected">' + selected_color.name + '</span>' +
                        '<input class="color-value" name="colors[' + index + '][color]" type="hidden" value="' + selected_color.id + '">' +
                        '<a href="javascript:void(0);" class="remove-color pull-right" data-toggle="tooltip" data-placement="top" title="Remove" style="font-size: 18px;"><i class="pg-trash"></i></a>' +
                        '</div>' +
                        '</div>' +
                        '<div class="card-body parent-container">' +
                        '<div id="color-dropzone-' + selected_color.id + '" class="dropzone dropzone-3 no-margin">' +
                        '<div class="fallback">' +
                        '<input type="file" accept="image/*">' +
                        '</div>' +
                        '</div>' +
                        '<div id="color-images-' + selected_color.id + '">' +
                        image_content + '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>';
                }
            } else {
                if ($('.' + color_class).length <= 0) {
                    content = '<div class="col-sm-12 col-md-6 col-lg-4 selected-color-content ' + color_class + '" data-index="' + color_class + '">' +
                        '<div class="card">' +
                        '<div class="card-header">' +
                        '<div class="card-title full-width">' +
                        '<span class="show-color-selected">' + selected_color.name + '</span>' +
                        '<input class="color-value" name="colors[' + index + '][color]" type="hidden" value="' + selected_color.id + '">' +
                        '<a href="javascript:void(0);" class="remove-color pull-right" data-toggle="tooltip" data-placement="top" title="Remove" style="font-size: 18px;"><i class="pg-trash"></i></a>' +
                        '</div>' +
                        '</div>' +
                        '<div class="card-body parent-container">' +
                        '<div id="color-dropzone-' + selected_color.id + '" class="dropzone dropzone-3 no-margin" data-index="' + index + '">' +
                        '<div class="fallback">' +
                        '<input type="file" accept="image/*">' +
                        '</div>' +
                        '</div>' +
                        '<div id="color-images-' + selected_color.id + '"></div>' +
                        '</div>' +
                        '</div>' +
                        '</div>';
                }
            }
            $('.color-item-container').append(content);
            $('[data-toggle="tooltip"]').tooltip();
            if ($('.' + color_class).length > 0) {
                init_dropzone(index, selected_color.id);
            }
            color_name_arrays.push(selected_color.slug);
        });
    }
    color_arrays = [];
    color_arrays.push(selected_colors);
    if (color_arrays.length > 0 && color_arrays[0][0] === 'default') {
        if (size_arrays.length == 0) {
            previous_selected_variant = [];
        } else if (size_arrays.length > 0 && size_arrays[0][0] == 'default') {
            previous_selected_variant = [];
        }
    }
    var removedItem = '';
    if (color_name_arrays.length <= prev_color_arrays.length) {
        removedItem = get_removed_item(prev_color_arrays, color_name_arrays);
    }
    prev_color_arrays = color_name_arrays;
    crossJoin(color_arrays, size_arrays, removedItem);
}

var get_removed_item = function(prev_arrays, current_arrays) {
    var value;
    $.each(prev_arrays, function(ii, el) {
        if (current_arrays[0] !== 'default') {
            if (jQuery.inArray(el, current_arrays) === -1) {
                value = el;
            }
        } else {
            value = el;
        }
        if (typeof value !== 'undefined') { return false; }
    });
    return value;
}
var init_dropzone = function(index, selected_color) {
    $("#color-dropzone-" + selected_color).dropzone({
        url: url_upload_image,
        headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content') },
        thumbnailWidth: 20,
        thumbnailHeight: 20,
        addRemoveLinks: true,
        paramName: "image",
        acceptedFiles: "image/*,pdf",
        maxFilesize: 2, // MB
        maxFiles: 1,
        // autoProcessQueue: false,
        accept: function(file, done) {
            var reader = new FileReader();
            reader.onload = (function(elem) {
                var image = new Image();
                image.src = elem.target.result;
                image.onload = function() {
                    // if (this.width < prod_min_width) {
                    //     notify_circle('danger', 'Error', 'Invalid image dimensions', '<i class="pg-icon">alert_info</i>');
                    //     done("Invalid dimensions");
                    // }
                    // else { 
                    done();
                    // }
                };
            });
            reader.readAsDataURL(file);
        },
        init: function() {
            this.on("sending", function(file, xhr, formData) {
                formData.append("type", "product");
            });

            this.on("success", function(file, response) {
                if (response.status == 'success') {
                    $('#color-images-' + selected_color).append('<input type="hidden" name="colors[' + index + '][images][]" data-image="' + file.name + '" value="' + response.filename + '"/>');
                    notify_circle('success', 'Success', 'One Image Uploaded', '<i class="pg-icon">alert_info</i>');
                } else {
                    notify_circle('danger', 'Error', 'Something went wrong. Please try again.', '<i class="pg-icon">alert_info</i>');
                    this.removeFile(file);
                }
            });

            this.on("removedfile", function(file) {
                $img = file.name;
                $.ajax({
                    url: url_remove_image,
                    type: 'POST',
                    data: { image: $img, type: 'product' },
                    async: false,
                    success: function(response) {
                        if (response.status == 'success') {
                            $('[data-image="' + file.name + '"]').remove();
                            notify_circle('success', 'Success', 'Image has been removed', '<i class="pg-icon">alert_info</i>');
                        } else {
                            notify_circle('danger', 'Error', 'Something went wrong. Please try again.', '<i class="pg-icon">alert_info</i>');
                        }
                    }
                })
            });

            this.on("maxfilesexceeded", function(file) {
                this.removeFile(file);
                notify_circle('danger', 'Error', 'Only 1 file allowed', '<i class="pg-icon">alert_info</i>');
            });
            var main = this;
            if (mockfiles != null) {
                $.each(mockfiles, function(mi, images) {
                    if (selected_color == mi) {
                        $.each(images, function(i, val) {
                            if (val['name'] != null) {
                                main.emit("addedfile", val);
                                main.emit("thumbnail", val, val['url']);
                                main.emit("complete", val);
                            }
                        });
                    }
                });
            }
        }
    });
}

var crossJoin = function(color_arrays, size_arrays, removedItem) {
    var color_arr = ['default'];
    var size_arr = ['default'];
    if (color_arrays.length > 0) {
        color_arr = color_arrays[0];
    }
    if (size_arrays.length > 0) {
        size_arr = size_arrays[0];
    }
    if (JSON.stringify(color_arr) != JSON.stringify(size_arr)) {
        const collection = collect(color_arr);
        const permutations = collection.crossJoin(size_arr)

        let arr = permutations.all();
        if (arr.length > 0) {
            display_form(arr, removedItem);
        }
    } else {
        $('.variant-item-container').html('');
    }
}

var display_form = function(arr, removedItem) {
    var content = '';
    $.each(arr, function(ix, selected_variant) {
        var variant_class = '';
        var variant = '';
        var variant_index = '';
        var index = '';
        
        if (selected_variant.includes('default')) {
            selected_variant_x = $.grep(selected_variant, function(value) {
                return value != 'default';
            });
            variant = selected_variant_x[0].name.toString();
            variant_class = selected_variant_x[0].slug.toString();
            variant_index = variant_class + '-default';
            index = selected_variant_x[0].id;
        } else {
            color_variant = selected_variant[0].name;
            size_variant = selected_variant[1].name;
            color_slug = selected_variant[0].slug;
            size_slug = selected_variant[1].slug;
            variant = color_variant + '/' + size_variant;
            variant_class = color_slug + '-' + size_slug;
            variant_index = variant_class;
            index = selected_variant[0].id+'-'+selected_variant[1].id;
        }

        hcolor = (selected_variant[0] != 'default') ? selected_variant[0].id : '';
        hsize = (selected_variant[1] != 'default') ? selected_variant[1].id : '';
        var active = 'checked';
        var checked = '';
        if (type == "edit") {
            var product_variants = product_variants_arr;
            if (product_variants != null) {
                var variant_arr = product_variants.map(function(value) { // product_variants['variant'] stored in db
                    return value['variant'].replace(/ /g, '');
                });
            }
            var price = '';
            var compare_price = '';
            var cost_price = '';
            var sku = '';
            var qty = '';
            variant = variant.replace(/ /g, '');
            if (jQuery.inArray(variant, variant_arr) !== -1) { // check if the data is stored in db
                $.each(product_variants, function(pindex, pvariant) {
                    if (pvariant['variant'].replace(/ /g, '') === variant) {
                        price = product_variants[pindex] != undefined ? product_variants[pindex].selling_price : 0;
                        compare_price = (product_variants[pindex] != undefined && product_variants[pindex].compare_price != null) ? product_variants[pindex].compare_price : '';
                        cost_price = (product_variants[pindex] != undefined && product_variants[pindex].cost_price != null) ? product_variants[pindex].cost_price : '';
                        sku = product_variants[pindex] != undefined ? product_variants[pindex].sku : '';
                        qty = product_variants[pindex] != undefined ? (product_variants[pindex].qty != null ? product_variants[pindex].qty : 0) : 0;
                        checked = product_variants[pindex] != undefined ? (product_variants[pindex].is_default == 10 ? 'checked' : '') : '';
                        active = product_variants[pindex] != undefined ? (product_variants[pindex].is_active == 10 ? 'checked' : '') : '';
                    }
                })
            }
            if (previous_selected_variant.length > 0) {
                if (jQuery.inArray(variant_index, previous_selected_variant) === -1) {
                    content += '<tr class="selected-size-content-' + variant_class + '" id="' + variant_index + '">' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input class="variant-value" name="variants[' + index + '][variant]" type="hidden" value="' + variant + '">' +
                        '<input class="variant-color" name="variants[' + index + '][color]" type="hidden" value="' + hcolor + '">' +
                        '<input class="variant-size" name="variants[' + index + '][size]" type="hidden" value="' + hsize + '">' +
                        '<div class="form-check danger inline m-b-0 required input-radio-button-for-default">' +
                        '<input class="radio-input-default" type="radio" name="variants[' + index + '][is_default]" data-index="' + index + '" id="is-default-' + index + '"' + checked + '>' +
                        '<label for="is-default-' + index + '" class="show-size-selected">' + variant + '</label>' +
                        '</div>' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][sku]" readonly placeholder="SKU" type="text" required class="form-control" autocomplete="off" value="' + sku + '"style="color:black;">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][qty]" placeholder="QTY" type="number" min="0" max="9999999999" required class="form-control autocomplete="off" value="' + qty + '">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][selling_price]" placeholder="' + currency + '" type="text" required class="form-control custom-decimal-field" autocomplete="off" value="' + price + '">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5" style="display:none;">' +
                        '<input name="variants[' + index + '][compare_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="' + compare_price + '">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][cost_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="' + cost_price + '">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<div class="form-check danger inline m-b-0">' +
                        '<input type="checkbox" name="variants[' + index + '][is_active]" data-index="' + index + '" id="is-active-' + index + '"' + active + '>' +
                        '<label for="is-active-' + index + '"> </label>' +
                        '</div>' +
                        // '<a href="javascript:void(0);" class="remove-size pull-right" data-toggle="tooltip" data-placement="top" title="Remove" style="font-size: 18px;"><i class="pg-trash"></i></a>' +
                        '</td>' +
                        '</tr>';
                }
            } else {
                content += '<tr class="selected-size-content-' + variant_class + '" id="' + variant_index + '">' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input class="variant-value" name="variants[' + index + '][variant]" type="hidden" value="' + variant + '">' +
                    '<input class="variant-color" name="variants[' + index + '][color]" type="hidden" value="' + hcolor + '">' +
                    '<input class="variant-size" name="variants[' + index + '][size]" type="hidden" value="' + hsize + '">' +
                    '<div class="form-check danger inline m-b-0 required input-radio-button-for-default">' +
                    '<input class="radio-input-default" type="radio" name="variants[' + index + '][is_default]" data-index="' + index + '" id="is-default-' + index + '"' + checked + '>' +
                    '<label for="is-default-' + index + '" class="show-size-selected">' + variant + '</label>' +
                    '</div>' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][sku]" readonly placeholder="SKU" type="text" required class="form-control" autocomplete="off" value="' + sku + '"style="color:black;">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][qty]" placeholder="QTY" type="number" min="0" max="9999999999" required class="form-control" autocomplete="off" value="' + qty + '">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][selling_price]" placeholder="' + currency + '" type="text" required class="form-control custom-decimal-field" autocomplete="off" value="' + price + '">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5" style="display:none;">' +
                    '<input name="variants[' + index + '][compare_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="' + compare_price + '">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][cost_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="' + cost_price + '">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<div class="form-check danger inline m-b-0">' +
                    '<input type="checkbox" name="variants[' + index + '][is_active]" data-index="' + index + '" id="is-active-' + index + '"' + active + '>' +
                    '<label for="is-active-' + index + '"> </label>' +
                    '</div>' +
                    // '<a href="javascript:void(0);" class="remove-size pull-right" data-toggle="tooltip" data-placement="top" title="Remove" style="font-size: 18px;"><i class="pg-trash"></i></a>' +
                    '</td>' +
                    '</tr>';
            }
        } else {
            if (previous_selected_variant.length > 0) {
                if (jQuery.inArray(variant_index, previous_selected_variant) === -1) {
                    content += '<tr class="selected-size-content-' + variant_class + '" id="' + variant_index + '">' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input class="variant-value" name="variants[' + index + '][variant]" type="hidden" value="' + variant + '">' +
                        '<input class="variant-color" name="variants[' + index + '][color]" type="hidden" value="' + hcolor + '">' +
                        '<input class="variant-size" name="variants[' + index + '][size]" type="hidden" value="' + hsize + '">' +
                        '<div class="form-check danger inline m-b-0 required input-radio-button-for-default">' +
                        '<input class="radio-input-default" type="radio" name="variants[' + index + '][is_default]" data-index="' + index + '" id="is-default-' + index + '">' +
                        '<label for="is-default-' + index + '" class="show-size-selected">' + variant + '</label>' +
                        '</div>' +
                        '</td>' +
                        // '<td class="v-align-middle p-l-5 p-r-5">' +
                        // '<input name="variants[' + index + '][sku]" placeholder="SKU" type="text" required class="form-control" autocomplete="off" value="">' +
                        // '</td>' +
                        '<input name="variants[' + index + '][sku]" type="hidden">' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][qty]" placeholder="QTY" type="number" min="0" max="9999999999" required class="form-control" autocomplete="off" value="">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][selling_price]" placeholder="' + currency + '" type="text" required class="form-control custom-decimal-field" autocomplete="off" value="">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5" style="display:none;">' +
                        '<input name="variants[' + index + '][compare_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<input name="variants[' + index + '][cost_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="">' +
                        '</td>' +
                        '<td class="v-align-middle p-l-5 p-r-5">' +
                        '<div class="form-check danger inline m-b-0">' +
                        '<input type="checkbox" name="variants[' + index + '][is_active]" data-index="' + index + '" id="is-active-' + index + '"checked>' +
                        '<label for="is-active-' + index + '"> </label>' +
                        '</div>' +
                        '</td>' +
                        '</tr>';
                }
            } else {
                content += '<tr class="selected-size-content-' + variant_class + '" id="' + variant_index + '">' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input class="variant-value" name="variants[' + index + '][variant]" type="hidden" value="' + variant + '">' +
                    '<input class="variant-color" name="variants[' + index + '][color]" type="hidden" value="' + hcolor + '">' +
                    '<input class="variant-size" name="variants[' + index + '][size]" type="hidden" value="' + hsize + '">' +
                    '<div class="form-check danger inline m-b-0 required input-radio-button-for-default">' +
                    '<input class="radio-input-default" type="radio" name="variants[' + index + '][is_default]" data-index="' + index + '" id="is-default-' + index + '">' +
                    '<label for="is-default-' + index + '" class="show-size-selected">' + variant + '</label>' +
                    '</div>' +
                    '</td>' +
                    // '<td class="v-align-middle p-l-5 p-r-5">' +
                    // '<input name="variants[' + index + '][sku]" placeholder="SKU" type="text" required class="form-control" autocomplete="off" value="">' +
                    // '</td>' +
                    '<input name="variants[' + index + '][sku]" type="hidden">' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][qty]" placeholder="QTY" type="number" min="0" max="9999999999" required class="form-control" autocomplete="off" value="">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][selling_price]" placeholder="' + currency + '" type="text" required class="form-control custom-decimal-field" autocomplete="off" value="">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5" style="display:none;">' +
                    '<input name="variants[' + index + '][compare_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<input name="variants[' + index + '][cost_price]" placeholder="' + currency + '" type="text" class="form-control custom-decimal-field" autocomplete="off" value="">' +
                    '</td>' +
                    '<td class="v-align-middle p-l-5 p-r-5">' +
                    '<div class="form-check danger inline m-b-0">' +
                    '<input type="checkbox" name="variants[' + index + '][is_active]" data-index="' + index + '" id="is-active-' + index + '"checked>' +
                    '<label for="is-active-' + index + '"> </label>' +
                    '</div>' +
                    '</td>' +
                    '</tr>';
            }
        }
        if (jQuery.inArray(variant_index, previous_selected_variant) === -1) {
            previous_selected_variant.push(variant_index);
        }
        var i_arr = [];
        $.each(previous_selected_variant, function(ii, el) {
            if (hcolor != '' && hsize != '') {
                if (el.includes('default')) {
                    $('.variant-item-container').find('#' + el).remove();
                    i_arr.push(el);
                }
            }
            var re = el.split('-');

            if (removedItem != '') {
                if (re[0] == removedItem || re[1] == removedItem) {
                    $('.variant-item-container').find('#' + el).remove();
                    i_arr.push(el);
                }
            }

        })
        previous_selected_variant = previous_selected_variant.filter(val => !i_arr.includes(val));
    });

    $('.variant-item-container').find('.variant-item-not-selected').remove();
    $('.variant-item-container').append(content);
    $('[data-toggle="tooltip"]').tooltip();
    if (type != "edit") {
        $('.variant-item-container').children('tr:first').find('.radio-input-default').attr('checked', true);
    }
    $('.input-radio-button-for-default').click(function(e) {
        e.preventDefault();
        $('.radio-input-default').removeAttr('checked');
        var id = $(this).find('.radio-input-default').data('index');
        $('#is-default-' + id).attr('checked', '')
    })
}