var summernote_init_simple = function() {
    $('.editor-container').summernote({
        placeholder: 'Description',
        height: 250,
        minHeight: 250,
        maxHeight: 500,
        disableDragAndDrop: true,
        shortcuts: false,
        tabDisable: true,
        toolbar: [
            ['style', ['style']],
            ['font', ['bold', 'underline', 'italic', 'strikethrough', 'clear']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['color', ['color']],
            ['mybutton', ['blockquote', 'undo', 'redo']],
            ['table', ['table']],
            ['insert', ['link']],
        ],
        buttons: {
            blockquote: function(context) {
                var ui = $.summernote.ui;
                var button = ui.button({
                    contents: '<i class="pg-icon">quote</i>',
                    tooltip: 'BlockQuote',
                    click: function() {
                        context.invoke('editor.formatBlock', 'Blockquote');
                    }
                });
                return button.render();
            }
        }
    });
}
var summernote_init_one = function(index) {
    var idxing = indexing();
    $('.editor-container-' + index).summernote({
        placeholder: 'Description',
        height: 250,
        minHeight: 250,
        maxHeight: 500,
        disableDragAndDrop: true,
        shortcuts: false,
        tabDisable: true,
        toolbar: [
            ['style', ['style']],
            ['font', ['bold', 'underline', 'italic', 'strikethrough', 'clear']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['color', ['color']],
            ['mybutton', ['blockquote', 'undo', 'redo']],
            ['table', ['table']],
            ['insert', ['link', 'media_use', 'video']],
            ['view', ['codeview']]
        ],
        callbacks: {
            onInit: function() {
                hyperlink_select2_init(index);
            },
            onPaste: function(e) {
                var bufferText = ((e.originalEvent || e).clipboardData || window.clipboardData).getData('Text');
                e.preventDefault();
                document.execCommand('insertText', false, bufferText);
            }
        },
        buttons: {
            blockquote: function(context) {
                var ui = $.summernote.ui;
                var button = ui.button({
                    contents: '<i class="pg-icon">quote</i>',
                    tooltip: 'BlockQuote',
                    click: function() {
                        context.invoke('editor.formatBlock', 'Blockquote');
                    }
                });
                return button.render();
            },
            media_use: function(context) {
                var ui = $.summernote.ui;
                var button = ui.button({
                    contents: '<i class="note-icon-picture open-use-media" data-type-media="single" id="' + idxing + '"></i>',
                    tooltip: 'Select Image',
                    click: function() {
                        set_current_media_texteditor(index);
                    }
                });
                return button.render();
            }
        }
    });
}
var summernote_init = function() {
    $('.editor-description').each(function() {
        summernote_init_one($(this).data('index'));
    });
}
var hyperlink_format = function(data) {
    if (data.loading) {
        return data.text;
    }
    return $(
        "<div class='select2-result-hyperlink clearfix'>" +
        "<div class='select2-result-hyperlink__meta'>" +
        "<div class='select2-result-hyperlink__data'>" +
        "<span>" + data.text + "</span>" +
        "<span class='pull-right'>" + data.created_at + "</span>" +
        "<input type='hidden' class='select2-result-hyperlink__title' value='" + data.text + "'>" +
        "<input type='hidden' class='select2-result-hyperlink__url' value='" + data.url + "'>" +
        "</div>" +
        "</div>" +
        "</div>"
    );
}
var hyperlink_selection = function(data) {
    return data.title || data.name || data.text;
}
var hyperlink_select2_init = function(index) {
    if ($('.has-hyperlink-search').length > 0) {
        $modal = $('.editor-container-' + index).parents('.editor-description').find('.note-modal.link-dialog');
        var search_content = '<div class="form-group note-form-group"><label for="note-dialog-link-txt-' + index + '" class="note-form-label">Search page links here</label><select id="note-dialog-link-txt-' + index + '" class="form-control note-form-control get-hyperlink" style="width: 100%;"></select></div>';
        $modal.removeAttr('tabindex');
        $modal.find('.modal-dialog').css('width', '800px!important');
        $modal.find('.modal-body').prepend(search_content);
        setTimeout(function() {
            hyperlink_select2_source();
        }, 1000);
    }
}
var hyperlink_select2_source = function() {
    $('.get-hyperlink').select2({
        ajax: {
            url: $('.has-hyperlink-search').data('hyperlink-search'),
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return {
                    q: params.term,
                    page: params.page
                };
            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: data.payload,
                    pagination: {
                        more: (params.page * 30) < data.total_count
                    }
                };
            },
            cache: false
        },
        placeholder: 'Search Hyperlink',
        minimumInputLength: 1,
        templateResult: hyperlink_format,
        templateSelection: hyperlink_selection
    });
}

$(document).on('click', '.select2-result-hyperlink', function(e) {
    e.preventDefault();
    var $this = $(this);
    var $modal = $('.note-modal.link-dialog.show');
    $modal.find('.note-link-text').val($this.find('.select2-result-hyperlink__title').val());
    $modal.find('.note-link-url').val($this.find('.select2-result-hyperlink__url').val());
    $modal.find('.note-link-btn').removeClass('disabled').removeAttr('disabled');
    $('.get-hyperlink').select2('close');
});