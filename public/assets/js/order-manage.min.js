var countries_data = JSON.parse(countries.replace(/&quot;/g, '"'));
var regions_data = JSON.parse(regions.replace(/&quot;/g, '"'));
var cities_data = JSON.parse(cities.replace(/&quot;/g, '"'));
var areas_data = JSON.parse(areas.replace(/&quot;/g, '"'));

var shipping_location_change = function (selected_data) {
    var country = '<option value="">Select Country</option><option value="0" data-id="0"' + ((selected_data.country == 0) ? 'selected' : '') + '>Others</option>';
    $.each(countries_data, function (item, val) {
        country += '<option value="' + val.id + '" data-id="' + val.id + '"' + ((val.id == selected_data.country) ? 'selected' : '') + '>' + val.name + '</option>';
    });
    $(".select_ship_country").html(country);
    $(".select_ship_country").trigger('change');

    var region = '<option value="">Select State/Zone</option>';
    $.each(regions_data, function (item, val) {
        if (val.country_id == selected_data.country) {
            region += '<option value="' + val.key + '" data-id="' + val.key + '"' + ((val.key == selected_data.region) ? 'selected' : '') +'>' + val.value + '</option>';
        }
    });
    $(".select_ship_region").html(region);

    var city = '<option value="">Select City</option>';
    $.each(cities_data, function (item, val) {
        if (val.region_id == selected_data.region) {
            city += '<option value="' + val.key + '" data-id="' + val.key + '"' + ((val.key == selected_data.city) ? 'selected' : '') + '>' + val.value + '</option>';
        }
    });
    $(".select_ship_city").html(city);

    var area = '<option value="">Select Area</option>';
    $.each(areas_data, function (item, val) {
        if (val.city_id == selected_data.city) {
            area += '<option value="' + val.key + '" data-delivery_amount="' + val.delivery_charge + '" data-conditional_amount="' + val.condition_amount + '"' + ((val.key == selected_data.area) ? 'selected' : '') +'>' + val.value + '</option>';
        }
    });
    $(".select_ship_area").html(area);
    $(".select_ship_area").trigger('change');

    $(".ship_zip").val(selected_data.zip);
    $(".shup_address_line_1").val(selected_data.address_line_1);
    $(".delivery-instructions").val(selected_data.delivery_instructions);
}
var billing_location_change = function (selected_data) {
    var country = '<option value="">Select Country</option><option value="0" data-id="0"' + ((selected_data.country == 0) ? 'selected' : '') + '>Others</option>';
    $.each(countries_data, function (item, val) {
        country += '<option value="' + val.id + '" data-id="' + val.id + '"' + ((val.id == selected_data.country) ? 'selected' : '') + '>' + val.name + '</option>';
    });
    $(".select_country").html(country);
    $(".select_country").trigger('change');

    var region = '<option value="">Select State/Zone</option>';
    $.each(regions_data, function (item, val) {
        if (val.country_id == selected_data.country) {
            region += '<option value="' + val.key + '" data-id="' + val.key + '"' + ((val.key == selected_data.region) ? 'selected' : '') +'>' + val.value + '</option>';
        }
    });
    $(".select_region").html(region);

    var city = '<option value="">Select City</option>';
    $.each(cities_data, function (item, val) {
        if (val.region_id == selected_data.region) {
            city += '<option value="' + val.key + '" data-id="' + val.key + '"' + ((val.key == selected_data.city) ? 'selected' : '') + '>' + val.value + '</option>';
        }
    });
    $(".select_city").html(city);

    var area = '<option value="">Select Area</option>';
    $.each(areas_data, function (item, val) {
        if (val.city_id == selected_data.city) {
            area += '<option value="' + val.key + '"' + ((val.key == selected_data.area) ? 'selected' : '') +'>' + val.value + '</option>';
        }
    });
    $(".select_area").html(area);

    $(".bill_address_line_1").val(selected_data.address_line_1);
    $(".bill_zip").val(selected_data.zip);
}
var same_billing_address = function () {
    $shipping = $(".shipping-address"),
        $billing = $(".billing-address");
    $billing.find(".bill_address_line_1").val($shipping.find(".shup_address_line_1").val());
    $billing.find(".select_ship_country").val($shipping.find(".select_ship_country").val());
    $billing.find(".select_ship_region").val($shipping.find(".select_ship_region").val());
    $billing.find(".select_ship_city").val($shipping.find(".select_ship_city").val());
    $billing.find(".select_area").val($shipping.find(".select_ship_area").val());
    $billing.find(".bill_zip").val($shipping.find(".ship_zip").val());
}
$(document).on("change", ".billing-as-shipping", function (e) {
    e.preventDefault();
    var $billing = $(".billing-address"), 
    $shipping = $(".shipping-address");
    if ($(this).is(":checked")) {
        $billing.hide();
        hide_bill();
        $billing.find(".bill_address_line_1").val($shipping.find(".ship_address_line_1").val());
        $billing.find(".select_region").val($shipping.find(".select_ship_region").val());
        $billing.find(".select_city").val($shipping.find(".select_ship_city").val());
        $billing.find(".select_area").val($shipping.find(".select_ship_area").val());
        $billing.find(".select_country").val($shipping.find(".select_ship_country").val());
        $billing.find(".bill_zip").val($shipping.find(".ship_zip").val());
    }
    else {
        $billing.show();
        show_bill();
        $billing.find(".bill_address_line_1").val('');
        $billing.find(".select_region").val('');
        $billing.find(".select_city").val('');
        $billing.find(".select_area").val('');
        $billing.find(".select_country").val('');
        $billing.find(".bill_zip").val('');
    }
});

$(document).on("change", ".select_country", function (e) {
    e.preventDefault();
    var selected_country = $(this).find(":selected").attr("data-id");
    if (selected_country == 0) {
        hide_bill();
    } else {
        show_bill();
        var region = '<option value="">Select State/Zone</option>';
        $.each(regions_data, function (item, val) {
            if (val.country_id == selected_country) {
                region += '<option value="' + val.key + '" data-id="' + val.key + '">' + val.value + '</option>';
            }
        });
        $(".select_region").html(region);
    }
});
$(document).on("change", ".select_region", function (e) {
    e.preventDefault();
    var selected_region = $(this).find(":selected").attr("data-id");
    var city = '<option value="">Select City</option>';
    $.each(cities_data, function (item, val) {
        if (val.region_id == selected_region) {
            city += '<option value="' + val.key + '" data-id="' + val.key + '">' + val.value + '</option>';
        }
    });
    $(".select_city").html(city);
});
$(document).on("change", ".select_city", function (e) {
    e.preventDefault();
    var selected_city = $(this).find(":selected").attr("data-id");
    var area = '<option value="">Select Area</option>';
    $.each(areas_data, function (item, val) {
        if (val.city_id == selected_city) {
            area += '<option value="' + val.key + '" data-delivery_amount="' + val.delivery_charge + '">' + val.value + '</option>';
        }
    });
    $(".select_area").html(area);
});
$(document).on("change", ".select_ship_country", function (e) {
    e.preventDefault();
    var selected_country = $(this).find(":selected").attr("data-id");
    if (selected_country == 0) {
        hide_ship();
    } else {
        show_ship();
        var region = '<option value="">Select State/Zone</option>';
        $.each(regions_data, function (item, val) {
            if (val.country_id == selected_country) {
                region += '<option value="' + val.key + '" data-id="' + val.key + '">' + val.value + '</option>';
            }
        });
        $(".select_ship_region").html(region);
    }
});
$(document).on("change", ".select_ship_region", function (e) {
    e.preventDefault();
    var selected_region = $(this).find(":selected").attr("data-id");
    var city = '<option value="">Select City</option>';
    $.each(cities_data, function (item, val) {
        if (val.region_id == selected_region) {
            city += '<option value="' + val.key + '" data-id="' + val.key + '">' + val.value + '</option>';
        }
    });
    $(".select_ship_city").html(city);
});
$(document).on("change", ".select_ship_city", function (e) {
    e.preventDefault();
    var selected_city = $(this).find(":selected").attr("data-id");
    var area = '<option value="">Select Area</option>';
    $.each(areas_data, function (item, val) {
        if (val.city_id == selected_city) {
            area += '<option value="' + val.key + '" data-delivery_amount="' + val.delivery_charge + '" data-conditional_amount="' + val.condition_amount + '">' + val.value + '</option>';
        }
    });
    $(".select_ship_area").html(area);
});

$(document).on("change", ".select_ship_area", function (e) {
    e.preventDefault();
    calculate_delivery($(this).find(":selected").attr("data-delivery_amount"), $(this).find(":selected").attr("data-conditional_amount"));
});

var calculate_delivery = function (delivery_charge, conditional_amount) {
    console.log(delivery_charge, conditional_amount);
    var subtotal = parseFloat(sub_total);
    var discount = parseFloat(discount_amount);
    var vat = parseFloat(vat_amount);
    var subtotal_after_discount = subtotal - discount;
    var currency = 'NPR';
    var totalPrice = subtotal_after_discount + vat;
    var delivery_charge_amt = 0;
    if (typeof delivery_charge !== "undefined" && typeof conditional_amount !== "undefined" && (parseFloat(conditional_amount)) <= subtotal_after_discount && delivery_charge > 0) {
        delivery_charge_amt = parseFloat(delivery_charge);
        $('.delivery-charge-item').css("display", "");
    } else {
        $('.delivery-charge-item').css("display", "none");
    }
    var delivery_charge12 = delivery_charge_amt;
    if (delivery_charge12 === undefined) {
        delivery_charge12 = 0;
    }
    var grandtotal = delivery_charge12 + totalPrice;
    $(".delivery_charge_text").text(currency + " " + money_format(delivery_charge12));
    $(".input_delivery_charge").val(delivery_charge12);
    $(".input_total").val(grandtotal);
    $(".grand_total_text").text(currency + " " + money_format(grandtotal));
}

var hide_ship = function () {
    $('.shipping-region').hide();
    $('.shipping-city').hide();
    $('.shipping-area').hide();
    $('.shipping-zip').hide();
    $('.select_ship_region').removeAttr('required');
    $('.select_ship_city').removeAttr('required');
    $('.select_ship_area').removeAttr('required');
    $('.select_ship_region option:selected').removeAttr('selected');
    $('.select_ship_city option:selected').removeAttr('selected');
    $('.select_ship_area option:selected').removeAttr('selected');
    $('.ship_zip').val('');
}

var show_ship = function () {
    $('.shipping-region').show();
    $('.shipping-city').show();
    $('.shipping-area').show();
    $('.shipping-zip').show();
    $('.select_ship_region').prop('required', true);
    $('.select_ship_city').prop('required', true);
    $('.select_ship_area').prop('required', true);
}

var hide_bill = function () {
    $('.billing-region').hide();
    $('.billing-city').hide();
    $('.billing-area').hide();
    $('.billing-zip').hide();
    $('.select_region').removeAttr('required');
    $('.select_city').removeAttr('required');
    $('.select_area').removeAttr('required');
    $('.select_region option:selected').removeAttr('selected');
    $('.select_city option:selected').removeAttr('selected');
    $('.select_area option:selected').removeAttr('selected');
    $('.bill_zip').val('');
}

var show_bill = function () {
    $('.billing-region').show();
    $('.billing-city').show();
    $('.billing-area').show();
    $('.billing-zip').show();
    $('.select_region').prop('required', true);
    $('.select_city').prop('required', true);
    $('.select_area').prop('required', true);
}

$(document).on('change', '.delivery-option', function() {
    $value = $(this).val();
    if($value == "1")
    {
        $('.address-parent').css('display', 'block');
        $('.shipping-options').show();
        $('.shipping-country').show();
        $('.shipping-address-line-1').show();
        $('.shipping-delivery-instructions').show();
        $('.select_ship_country').prop('required', true);
        $('.ship_address_line_1').prop('required', true);
        show_ship();
    }else{
        $('.address-parent').css('display', 'none');
        $('.shipping-options').hide();
        $('.shipping-country').hide();
        $('.shipping-address-line-1').hide();
        $('.shipping-delivery-instructions').hide();
        $('.select_ship_country').removeAttr('required');
        $('.select_ship_country option:selected').removeAttr('selected');
        $('.ship_address_line_1').removeAttr('required');
        $('.ship_address_line_1').val('');
        $('.delivery-instructions').val('');
        hide_ship();
    }
})
