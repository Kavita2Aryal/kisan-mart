Dropzone.autoDiscover = false;
var myDropzone1 = new Dropzone(".dropzone-media", { 
    url: upload_url,
    headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content') },
    thumbnailWidth: 240,
    thumbnailHeight: 240,
    addRemoveLinks: true,
    paramName: "image", 
    acceptedFiles: "image/*,pdf",
    maxFilesize: 2,
    maxFiles : 12,
    uploadMultiple: false,
    autoProcessQueue: true,
    parallelUploads: 1,
    accept: function(file, done) {
        var reader = new FileReader();
        reader.onload = (function(elem) {
            var image = new Image(); 
            image.src = elem.target.result;
            image.onload = function() {
                if (this.width < min_width || this.height < min_height) { 
                    notify_circle('danger', 'Error', 'Invalid dimensions', '<i class="pg-icon">alert_info</i>');
                    done("Invalid dimensions");
                }
                else { done(); }
            };
        });
        reader.readAsDataURL(file);
    },
    init: function () {
        this.on("processing", function(event) { });
        this.on("success", function (file, response) {
            if (response.status == 'success') {
                $('.media-temp').append('<input type="hidden" data-image="'+file.name+'" value="'+response.filename+'"/>'); 
                notify_circle('success', 'Success', 'One Image Uploaded', '<i class="pg-icon">alert_info</i>');
            }
            else {
                notify_circle('danger', 'Error', 'Something went wrong', '<i class="pg-icon">alert_info</i>');
                myDropzone1.removeFile(file);
            }
        });
        this.on("removedfile", function(file) {
            $.ajax({
                url: remove_url,
                type: "post",
                data: { image: $('[data-image="'+file.name+'"]').val()},
                async: false,
                success: function (response) {
                	$('[data-image="'+file.name+'"]').remove();
                    if (response.status == 'failed') console.log('file not removed');
                }
            });            
        });
        this.on("maxfilesexceeded", function(file){
            myDropzone1.removeFile(file);
            notify_circle('danger', 'Warning', 'Only 10 files allowed', '<i class="pg-icon">alert_info</i>');
        });
    }
});

/*
will generate confict if same named two different images are uploaded at once
'<input type="hidden" data-image="'+file.name+'" value="'+response.filename+'"/>'
*/
