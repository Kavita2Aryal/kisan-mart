$(document).ready(function () {
    $('.collection-select-init').select2({});
});
$(document).on('click', '#search-prod-item', function (e) {
    e.preventDefault();
    var categories = $("#search-category-listing").val();
    var brands = $("#search-brand-listing").val();
    var product = $("#search-product-listing").val();
    var ready_to_wear = 0;
    if($("#search-ready-to-wear").is(':checked')){
        ready_to_wear = 10;
    }
    console.log(ready_to_wear);
    $.ajax({
        type: 'GET',
        data: { categories: categories, brands: brands, product: product, ready_to_wear: ready_to_wear },
        url: get_filter_promocode_products,
        async: false,
        success: function (res) {
            if (res.status) {
                var categories = res.cat;
                var brands = res.brands;
                var prod_name = res.prod_name;
                var product_ids = res.product_ids;
                var content = '';
                var i = 0;
                $.each(res.results, function (index, product) {
                    var status = '';
                    var image = ((product.thumbnail != null) && (typeof product.thumbnail !== 'undefined')) ? product.thumbnail.image : "clothing3.jpg";
                    var category = (product.category != null) ? product.category.name : "No Category";
                    // var category_id = (product.category != null) ? product.category.id : "";
                    var brand = (product.brand != null) ? product.brand.name : "No Brand";
                    // var brand_id = (product.brand != null) ? product.brand.id : "";

                    var product_name = (product.name.length > 15) ? product.name.substring(0, 15) + '...' : product.name;

                    if ($.inArray(product.id, product_ids) !== -1) {
                        status = 'checked';
                    }
                    content += '<div class="media-masonry-item option-prod-item-' + product.id + '" style="width: auto;">' +
                        '<div class="media-image">' +
                        '<a href="" target="_blank">' +
                        '<img data-src="" class="full-width lozad">' +
                        '</a>' +
                        '</div>' +
                        '<div class="media-options">' +
                        '<div>' +
                        '<p class="font-montserrat m-b-0 fs-18"><strong>' + product_name + '</strong></p>' +
                        '<p class="font-montserrat m-b-0 text-mute"><small>' + category + '</small></p>' +
                        '<p class="font-montserrat m-b-0 text-mute"><small>' + brand + '</small></p>' +
                        '</div>' +
                        '<div class="clearfix"></div>' +
                        '<div class="pull-right">' +
                        '<a href="#" class="btn btn-link">' +
                        '<div class="form-check info m-b-0">' +
                        '<input type="checkbox" class="product-search" id="selected-item-' + product.id + '" name="product['+i+'][index]" value="' + product.id + '" '+status+'>' +
                        '<label for="selected-item-' + product.id + '">SELECT</label>' +
                        '</div>' +
                        '</a>' +
                        '</div>' +
                        '<div class="clearfix"></div>' +
                        '</div>' +
                        '</div> ';
                    i++;
                });
                $(".select-product-filter").css('display', 'inline-block')
                $(".select-all-products").css('display', 'inline-block')
                $("#option-product-listing").html(content)
            }
        }
    })
});

$(document).on('click', '.select-product-filter', function (e) {
    e.preventDefault();
    var form = $('#promocode-products-save-form');
    var checked_products = $("input:checked:checked").length;
    if (checked_products > 0) {
        $(".thunder-loader").css("display", "block");
        form.submit();
    } else {
        notify_bar('danger', 'Please check at leat one product.');
    }
})

$(document).on('click', '.remove-selected-product', function (e) {
    e.preventDefault();
    var checked_products = $("input[name='selected_product']:checked").length;
    if (checked_products > 0) {
        var arr = [];
        $("input[name='selected_product']:checked").each(function () {
            arr.push(this.value);
        });
        $.ajax({
            type: 'POST',
            data: {
                product: arr
            },
            url: remove_selected_product,
            async: false,
            success: function (res) {
                if (res.status) {
                    notify_reload('success', 'Selected Product has been removed.');
                }
            }
        });
    } else {
        notify_bar('danger', 'Please check at leat one product.');
    }
})

$(document).on('click', '#open-product-listing', function (e) {
    e.preventDefault();
    var index = $(this).data('index');
    var actionURL = $(this).data('action');
    $('#promocode-products-save-form').attr('action', actionURL)

    $.ajax({
        type: 'POST',
        data: { index: index },
        url: get_promocode_products_url,
        async: false,
        success: function (res) {
            if (res.status) {
                $('#promocode-products-save-form').attr('action', actionURL);
                $('#product-listing').modal('show');
                $('#option-product-listing').html(res.html)
            }
        }
    });
});

$(document).on('click', '.uncheck-all-products', function (e) {
    e.preventDefault();
    var checked_products = $("input[name='selected_product']:checked").length;
    if (checked_products > 0) {
        $(this).text('SELECT ALL');
        $("input[name='selected_product']").prop('checked', false);
    }
    $(this).removeClass('uncheck-all-products').addClass('check-all-products');
})

$(document).on('click', '.check-all-products', function (e) {
    e.preventDefault();
    $(this).text('UNSELECT ALL');
    $("input[name='selected_product']").prop('checked', true);
    $(this).removeClass('check-all-products').addClass('uncheck-all-products');
})

$(document).on('click', '.select-all-products', function (e) {
    e.preventDefault();
    $(this).text('UNSELECT ALL');
    $(".product-search").prop('checked', true);
    $(this).removeClass('select-all-products').addClass('unselect-all-products');
})

$(document).on('click', '.unselect-all-products', function (e) {
    e.preventDefault();
    var checked_products = $(".product-search").length;
    if (checked_products > 0) {
        $(this).text('SELECT ALL');
        $(".product-search").prop('checked', false);
    }
    $(this).removeClass('unselect-all-products').addClass('select-all-products');
})